<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>.HSX - Explore</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Include JSZip library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body class="bg-gradient-to-r from-purple-700 via-indigo-600 to-blue-500 min-h-screen font-sans text-white">
  <!-- Navbar -->
  <nav class="flex justify-between items-center p-6 bg-black/30 backdrop-blur-md">
    <h1 class="text-2xl font-bold">.HSX Language</h1>
    <div class="space-x-4">
      <a href="index.html" class="hover:text-yellow-300">Home</a>
      <a href="explore.html" class="hover:text-yellow-300">Explore</a>
    </div>
  </nav>

  <!-- Extensions Grid -->
  <section class="mt-16 px-6">
    <h2 class="text-3xl font-bold mb-8 text-center">Explore Extensions</h2>
    <div id="extensionsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Extension cards will populate here -->
    </div>
  </section>

  <footer class="text-center py-6 text-gray-300 mt-12">
    Â© 2026 William Isaiah Jones | .HSX
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const grid = document.getElementById('extensionsGrid');

      try {
        const res = await fetch('/api/extensions');
        if (!res.ok) throw new Error('Failed to fetch extensions');
        const exts = await res.json();

        exts.forEach(ext => {
          const card = document.createElement('div');
          card.className = "bg-black/20 backdrop-blur-md rounded-xl p-6 hover:scale-105 transition transform";

          card.innerHTML = `
            <h3 class="text-xl font-bold mb-2">${ext.name}</h3>
            <p class="text-gray-300 mb-4">By: ${ext.author}</p>
            <button class="bg-purple-600 px-4 py-2 rounded hover:bg-purple-500 download-btn">Download ZIP</button>
          `;

          card.querySelector('.download-btn').addEventListener('click', async () => {
            const zip = new JSZip();

            // Fetch each file as blob and add to zip
            const files = [
              { url: ext.hsx_url, name: ext.hsx_url?.split('/').pop() },
              { url: ext.js_url, name: ext.js_url?.split('/').pop() },
              { url: ext.html_url, name: ext.html_url?.split('/').pop() },
              { url: ext.test_url, name: ext.test_url?.split('/').pop() },
              { url: ext.success_url, name: ext.success_url?.split('/').pop() }
            ];

            for (const file of files) {
              if (!file.url) continue;
              try {
                const response = await fetch(file.url);
                const blob = await response.blob();
                zip.file(file.name, blob);
              } catch (err) {
                console.warn(`Failed to fetch ${file.name}:`, err);
              }
            }

            // Generate ZIP and trigger download
            const content = await zip.generateAsync({ type: 'blob' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(content);
            a.download = `${ext.name}.zip`;
            document.body.appendChild(a);
            a.click();
            a.remove();
          });

          grid.appendChild(card);
        });

      } catch (err) {
        console.error(err);
        grid.innerHTML = "<p class='text-red-400 text-center'>Failed to load extensions. Try again later.</p>";
      }
    });
  </script>
</body>
</html>
